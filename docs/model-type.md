# 生成可能なモデルの種類と特性

このプロジェクトでは学習に利用できるさまざまなモデルが用意されています。設定ファイルやコマンドラインから`--type`を指定することで、任意のモデルを選択できます。以下では主要なモデル種別とその特徴を説明します。

## TensorFlow 系モデル

### linear
単純な CNN のあとに線形層を二つ配置し、ステアリング角度とスロットルを連続値として出力します。一般的な学習に用いられる基本モデルです。

### categorical
ステアリングとスロットルを離散化し、分類問題として学習します。出力はそれぞれ 15 クラス、20 クラスのソフトマックス値です。各クラスの確率分布が得られるため推論結果の信頼度を確認できます。

### inferred
ステアリング角度のみをネットワークで推定し、スロットルは角度から自動計算します。単純な構成のためデータ量が少ない場合に適しています。

### imu
画像に加え IMU センサの値を入力として利用します。加速度や角速度を取り込むことで車体の状態変化を学習に反映できます。

### memory
過去のステアリングとスロットルを履歴として入力に加えるモデルです。時系列情報を扱えるため出力が滑らかになります。

### behavioral
車体の状態を表すワンホットベクトルを画像とともに入力し、走行モードに応じた制御を学習します。

### localizer
ステアリングとスロットルに加え、走行位置をカテゴリとして推定します。複数のコースを走る場合に役立ちます。

### rnn
複数フレームの画像列を LSTM で処理するモデルです。時間的特徴を捉えることで安定した制御を実現します。

### 3d
3D 畳み込みを用いて画像列を直接処理するモデルです。動画情報を多く含むため学習には大きな計算資源が必要です。

### latent
自己符号化器をベースにした構造で、画像の潜在表現を生成しつつ制御値を出力します。画像再構成も同時に学習するため入力状態の把握に適しています。

## PyTorch 系モデル

### resnet18
事前学習済みの ResNet18 を利用したモデルで、PyTorch Lightning を用いて学習します。画像を 224×224 にリサイズして入力します。

## FastAI 系モデル

### fastai_linear
FastAI フレームワークで構築された線形モデルです。基本的な構造は `linear` と類似しています。

## 変換モデル

### tflite_ プレフィックス
`tflite_` を先頭に付けたモデルタイプを指定すると、学習後に TensorFlow Lite 形式へ変換されたモデルが生成されます。軽量な推論環境での利用に適します。

### tensorrt_ プレフィックス
`tensorrt_` を先頭に付けると TensorRT 形式でモデルを出力します。NVIDIA GPU 上で高速に推論したい場合に使用します。

## モデルタイプの指定例

```bash
python manage.py train --type=linear --model=models/mypilot.h5
python manage.py train --type=tflite_linear --model=models/mypilot.h5
python manage.py train --type=resnet18 --model=models/mypilot.pth
```

上記のようにタイプ名を指定するだけで、目的に合ったモデルを容易に生成できます。